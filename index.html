<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding the Library Management System</title>
    <style>
        :root {
            --code-bg: #f5f5f5;
            --border-color: #e0e0e0;
            --primary-color: #2563eb;
            --text-color: #1f2937;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .inner-container {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            pre {
                padding-left: 8px !important;
            }

            .container {
                padding-left: 10px !important;
                padding-right: 10px !important;
            }

            .inner-container {
                padding: 10px 0;
                border: none;
            }

            .diagram {
                padding: 0 !important;
            }
        }

        .language-toggle {
            position: sticky;
            top: 0;
            background: white;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0;
            z-index: 100;
        }

        .toggle-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .toggle-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        pre {
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .keyword { color: #0550ae; }
        .string { color: #0a7a00; }
        .comment { color: #6b7280; }
        .function { color: #8250df; }
        .number { color: #116329; }

        .diagram {
            width: 100%;
            max-width: 600px;
            margin: 2rem auto;
            padding: 1rem;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        [data-lang="vi"] {
            display: none;
        }

        .active[data-lang="vi"] {
            display: block;
        }

        .active[data-lang="en"] {
            display: block;
        }
        
        .collapsible {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin: 1rem 0;
        }

        .collapsible-header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f1f5f9;
        }

        .collapsible-content {
            padding: 0 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible.open .collapsible-content {
            max-height: 500px;
            padding: 1rem;
        }

        /* Add to existing CSS */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            margin: 1rem 0;
        }

        .table-container table {
            min-width: 800px; /* Ensures table won't squish below this width */
            width: 100%;
            border-collapse: collapse;
        }

        .table-container th,
        .table-container td {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .table-container th {
            background-color: #f8fafc;
        }

        /* Make code samples in table not wrap */
        .table-container code {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="language-toggle">
        <div class="toggle-group">
            <label>
                <input type="radio" name="language" value="en" checked>
                English
            </label>
            <label>
                <input type="radio" name="language" value="vi">
                Ti·∫øng Vi·ªát
            </label>
        </div>
    </div>

    <div class="container">
        <div class="inner-container">
            <div data-lang="en">
                <h1>Understanding the Library Management System</h1>
                <p>This guide will help you understand the key concepts behind our Flask-based library management system. We'll explore how the different parts work together and dive into important programming concepts.</p>
            </div>
            <div data-lang="vi">
                <h1>T√¨m Hi·ªÉu H·ªá Th·ªëng Qu·∫£n L√Ω Th∆∞ Vi·ªán</h1>
                <p>H∆∞·ªõng d·∫´n n√†y s·∫Ω gi√∫p b·∫°n hi·ªÉu c√°c kh√°i ni·ªám ch√≠nh ƒë·∫±ng sau h·ªá th·ªëng qu·∫£n l√Ω th∆∞ vi·ªán d·ª±a tr√™n Flask. Ch√∫ng ta s·∫Ω kh√°m ph√° c√°ch c√°c ph·∫ßn kh√°c nhau ho·∫°t ƒë·ªông c√πng nhau v√† ƒëi s√¢u v√†o c√°c kh√°i ni·ªám l·∫≠p tr√¨nh quan tr·ªçng.</p>
            </div>

            <section>
                <div data-lang="en">
                    <h2>HTTP Request/Response Cycle</h2>
                    <p>Before diving into the code, it's essential to understand how web applications work:</p>
                </div>
                <div data-lang="vi">
                    <h2>Chu Tr√¨nh Request/Response HTTP</h2>
                    <p>Tr∆∞·ªõc khi ƒëi s√¢u v√†o m√£ ngu·ªìn, ƒëi·ªÅu quan tr·ªçng l√† ph·∫£i hi·ªÉu c√°ch ho·∫°t ƒë·ªông c·ªßa ·ª©ng d·ª•ng web:</p>
                </div>

                <svg class="diagram" viewBox="0 0 600 300">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#4b5563"/>
                        </marker>
                    </defs>
                    
                    <!-- Browser Box -->
                    <rect x="50" y="50" width="200" height="100" rx="10" fill="#e5e7eb" stroke="#4b5563"/>
                    <text x="150" y="100" text-anchor="middle" fill="#1f2937">Browser</text>
                    
                    <!-- Flask Server Box -->
                    <rect x="350" y="50" width="200" height="100" rx="10" fill="#e5e7eb" stroke="#4b5563"/>
                    <text x="450" y="100" text-anchor="middle" fill="#1f2937">Flask Server</text>
                    
                    <!-- Database Box -->
                    <rect x="350" y="200" width="200" height="50" rx="10" fill="#e5e7eb" stroke="#4b5563"/>
                    <text x="450" y="230" text-anchor="middle" fill="#1f2937">SQLite Database</text>
                    
                    <!-- Arrows -->
                    <path d="M 250 80 L 350 80" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="300" y="70" text-anchor="middle" fill="#4b5563" font-size="12">HTTP Request</text>
                    
                    <path d="M 350 120 L 250 120" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="300" y="140" text-anchor="middle" fill="#4b5563" font-size="12">HTTP Response</text>
                    
                    <path d="M 450 150 L 450 200" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="470" y="175" text-anchor="middle" fill="#4b5563" font-size="12">Query/Update</text>
                </svg>

                <div data-lang="en">
                    <h3>Key Concepts:</h3>
                    <ul>
                        <li>The browser sends HTTP requests to specific routes on our Flask server</li>
                        <li>Flask processes these requests using route handlers (functions)</li>
                        <li>Route handlers interact with the database when needed</li>
                        <li>Flask sends back HTTP responses (HTML, status codes, messages)</li>
                    </ul>
                </div>
                <div data-lang="vi">
                    <h3>Kh√°i Ni·ªám Ch√≠nh:</h3>
                    <ul>
                        <li>Tr√¨nh duy·ªát g·ª≠i c√°c y√™u c·∫ßu HTTP ƒë·∫øn c√°c routes c·ª• th·ªÉ tr√™n m√°y ch·ªß Flask c·ªßa ch√∫ng ta</li>
                        <li>Flask x·ª≠ l√Ω c√°c y√™u c·∫ßu n√†y b·∫±ng c√°c h√†m x·ª≠ l√Ω route</li>
                        <li>C√°c h√†m x·ª≠ l√Ω route t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu khi c·∫ßn</li>
                        <li>Flask g·ª≠i l·∫°i c√°c ph·∫£n h·ªìi HTTP (HTML, m√£ tr·∫°ng th√°i, th√¥ng b√°o)</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>

    <div class="container">
        <div class="inner-container">
            <section id="route-handling">
                <div data-lang="en">
                    <h2>Understanding Route Handlers</h2>
                    <p>Route handlers in Flask follow a consistent pattern known as "business logic flow". Let's break down the structure using the <code>create_loan</code> route as an example:</p>
                </div>
                <div data-lang="vi">
                    <h2>Hi·ªÉu v·ªÅ Route Handlers</h2>
                    <p>C√°c route handler trong Flask tu√¢n theo m·ªôt m·∫´u nh·∫•t qu√°n ƒë∆∞·ª£c g·ªçi l√† "lu·ªìng logic nghi·ªáp v·ª•". H√£y ph√¢n t√≠ch c·∫•u tr√∫c b·∫±ng v√≠ d·ª• v·ªÅ route <code>create_loan</code>:</p>
                </div>

                <pre><span class="keyword">@app.route</span>(<span class="string">'/create_loan'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> <span class="function">create_loan</span>():
    <span class="comment"># 1. Receive input from client</span>
    member_id = request.form.get(<span class="string">'member_id'</span>)
    book_id = request.form.get(<span class="string">'book_id'</span>)

    <span class="comment"># 2. Validate input data</span>
    <span class="keyword">if not</span> member_id <span class="keyword">or not</span> book_id:
        <span class="keyword">return</span> <span class="string">"Missing required fields"</span>, <span class="number">400</span>

    <span class="comment"># 3. Database operations</span>
    <span class="keyword">try</span>:
        conn = get_db()
        cursor = conn.cursor()
        
        <span class="comment"># Query existing data</span>
        book = cursor.execute(<span class="string">'SELECT status FROM books WHERE id = ?'</span>, 
                            (book_id,)).fetchone()

        <span class="comment"># Validate business rules</span>
        <span class="keyword">if not</span> book:
            <span class="keyword">return</span> <span class="string">"Book not found"</span>, <span class="number">404</span>
        
        <span class="comment"># Perform mutations</span>
        cursor.execute(<span class="string">'INSERT INTO loans ...'</span>)
        
        <span class="comment"># 4. Return response</span>
        <span class="keyword">return</span> <span class="string">"Loan created successfully"</span>, <span class="number">201</span>
        
    <span class="keyword">finally</span>:
        conn.close()</pre>

                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">üîç Learn More: Route Handler Patterns</div>
                        <div data-lang="vi">üîç T√¨m Hi·ªÉu Th√™m: C√°c M·∫´u Route Handler</div>
                    </div>
                    <div class="collapsible-content">
                        <div data-lang="en">
                            <p>Every route handler typically follows these steps:</p>
                            <ol>
                                <li><strong>Input Reception</strong>: Get data from request.form, request.args, or URL parameters</li>
                                <li><strong>Validation</strong>: Check if data is present and in correct format</li>
                                <li><strong>Database Operations</strong>: Query or modify the database</li>
                                <li><strong>Response</strong>: Return appropriate data and status code</li>
                            </ol>
                        </div>
                        <div data-lang="vi">
                            <p>M·ªói route handler th∆∞·ªùng tu√¢n theo c√°c b∆∞·ªõc sau:</p>
                            <ol>
                                <li><strong>Nh·∫≠n Input</strong>: L·∫•y d·ªØ li·ªáu t·ª´ request.form, request.args, ho·∫∑c tham s·ªë URL</li>
                                <li><strong>X√°c Th·ª±c</strong>: Ki·ªÉm tra d·ªØ li·ªáu c√≥ t·ªìn t·∫°i v√† ƒë√∫ng ƒë·ªãnh d·∫°ng</li>
                                <li><strong>Thao T√°c Database</strong>: Truy v·∫•n ho·∫∑c s·ª≠a ƒë·ªïi c∆° s·ªü d·ªØ li·ªáu</li>
                                <li><strong>Ph·∫£n H·ªìi</strong>: Tr·∫£ v·ªÅ d·ªØ li·ªáu v√† m√£ tr·∫°ng th√°i ph√π h·ª£p</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <section id="datetime-methods">
                    <div data-lang="en">
                        <h2>Python Objects and Methods</h2>
                        <p>In Python, objects (like datetime) come with built-in methods - think of them as "tools in a toolbox". You access these tools using the dot (.) operator.</p>
                    </div>
                    <div data-lang="vi">
                        <h2>ƒê·ªëi T∆∞·ª£ng v√† Ph∆∞∆°ng Th·ª©c trong Python</h2>
                        <p>Trong Python, c√°c ƒë·ªëi t∆∞·ª£ng (nh∆∞ datetime) ƒëi k√®m v·ªõi c√°c ph∆∞∆°ng th·ª©c c√≥ s·∫µn - h√£y nghƒ© v·ªÅ ch√∫ng nh∆∞ "c√°c c√¥ng c·ª• trong h·ªôp c√¥ng c·ª•". B·∫°n truy c·∫≠p c√°c c√¥ng c·ª• n√†y b·∫±ng to√°n t·ª≠ d·∫•u ch·∫•m (.).</p>
                    </div>

                    <div class="demo-container">
                        <pre><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

<span class="comment"># Creating a datetime object</span>
now = datetime.now()

<span class="comment"># Using different methods</span>
formatted_date = now.strftime(<span class="string">'%Y-%m-%d'</span>)
future_date = now + timedelta(days=<span class="number">14</span>)</pre>
                    </div>

                    <div data-lang="en">
                        <h3>Common Datetime Methods</h3>
                    </div>
                    <div data-lang="vi">
                        <h3>C√°c Ph∆∞∆°ng Th·ª©c Datetime Ph·ªï Bi·∫øn</h3>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Method</th>
                                <th data-lang="en">Description</th>
                                <th data-lang="vi">M√¥ t·∫£</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>strftime(format)</code></td>
                                <td data-lang="en">Converts datetime to string</td>
                                <td data-lang="vi">Chuy·ªÉn datetime th√†nh chu·ªói</td>
                            </tr>
                            <tr>
                                <td><code>strptime(string, format)</code></td>
                                <td data-lang="en">Creates datetime from string</td>
                                <td data-lang="vi">T·∫°o datetime t·ª´ chu·ªói</td>
                            </tr>
                            <tr>
                                <td><code>timestamp()</code></td>
                                <td data-lang="en">Converts to Unix timestamp</td>
                                <td data-lang="vi">Chuy·ªÉn ƒë·ªïi th√†nh Unix timestamp</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="python-methods">
                    <div data-lang="en">
                        <h2>Common Python Types and Their Methods</h2>
                        <p>Every type in Python comes with useful built-in methods. Understanding these "tools in the toolbox" helps you manipulate data efficiently. Sometimes you'll need to convert between types - this is called "type conversion" or "casting".</p>
                    </div>
                    <div data-lang="vi">
                        <h2>C√°c Ki·ªÉu D·ªØ Li·ªáu Python Ph·ªï Bi·∫øn v√† Ph∆∞∆°ng Th·ª©c c·ªßa Ch√∫ng</h2>
                        <p>M·ªçi ki·ªÉu d·ªØ li·ªáu trong Python ƒë·ªÅu ƒëi k√®m v·ªõi c√°c ph∆∞∆°ng th·ª©c c√≥ s·∫µn h·ªØu √≠ch. Hi·ªÉu v·ªÅ nh·ªØng "c√¥ng c·ª• trong h·ªôp c√¥ng c·ª•" n√†y gi√∫p b·∫°n x·ª≠ l√Ω d·ªØ li·ªáu hi·ªáu qu·∫£. ƒê√¥i khi b·∫°n c·∫ßn chuy·ªÉn ƒë·ªïi gi·ªØa c√°c ki·ªÉu - ƒëi·ªÅu n√†y ƒë∆∞·ª£c g·ªçi l√† "chuy·ªÉn ƒë·ªïi ki·ªÉu".</p>
                    </div>
                
                    <div class="table-container">

                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Method</th>
                                    <th data-lang="en">Description</th>
                                    <th data-lang="vi">M√¥ t·∫£</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>str</td>
                                    <td><code>split()</code></td>
                                    <td data-lang="en">Splits string into list</td>
                                    <td data-lang="vi">T√°ch chu·ªói th√†nh list</td>
                                    <td><code>"a,b,c".split(',') ‚Üí ['a','b','c']</code></td>
                                </tr>
                                <tr>
                                    <td>str</td>
                                    <td><code>strip()</code></td>
                                    <td data-lang="en">Removes whitespace</td>
                                    <td data-lang="vi">X√≥a kho·∫£ng tr·∫Øng</td>
                                    <td><code>" hello ".strip() ‚Üí "hello"</code></td>
                                </tr>
                                <tr>
                                    <td>str</td>
                                    <td><code>isdigit()</code></td>
                                    <td data-lang="en">Checks if string is number</td>
                                    <td data-lang="vi">Ki·ªÉm tra chu·ªói c√≥ ph·∫£i s·ªë</td>
                                    <td><code>"123".isdigit() ‚Üí True</code></td>
                                </tr>
                                <tr>
                                    <td>list</td>
                                    <td><code>append()</code></td>
                                    <td data-lang="en">Adds item to end</td>
                                    <td data-lang="vi">Th√™m ph·∫ßn t·ª≠ v√†o cu·ªëi</td>
                                    <td><code>[1,2].append(3) ‚Üí [1,2,3]</code></td>
                                </tr>
                                <tr>
                                    <td>list</td>
                                    <td><code>sort()</code></td>
                                    <td data-lang="en">Sorts the list in-place</td>
                                    <td data-lang="vi">S·∫Øp x·∫øp list</td>
                                    <td><code>[3,1,2].sort() ‚Üí [1,2,3]</code></td>
                                </tr>
                                <tr>
                                    <td>dict</td>
                                    <td><code>get()</code></td>
                                    <td data-lang="en">Safe way to get value</td>
                                    <td data-lang="vi">C√°ch an to√†n ƒë·ªÉ l·∫•y gi√° tr·ªã</td>
                                    <td><code>dict.get('key', 'default')</code></td>
                                </tr>
                                <tr>
                                    <td>dict</td>
                                    <td><code>keys()</code></td>
                                    <td data-lang="en">Gets all keys</td>
                                    <td data-lang="vi">L·∫•y t·∫•t c·∫£ keys</td>
                                    <td><code>{'a':1, 'b':2}.keys()</code></td>
                                </tr>
                                <tr>
                                    <td>int/float</td>
                                    <td><code>as_integer_ratio()</code></td>
                                    <td data-lang="en">Converts to fraction (as tuple)</td>
                                    <td data-lang="vi">Chuy·ªÉn th√†nh ph√¢n s·ªë (nh∆∞ tuple)</td>
                                    <td><code>3.5.as_integer_ratio() ‚Üí (7,2)</code></td>
                                </tr>
                                <tr>
                                    <td>datetime</td>
                                    <td><code>strftime()</code></td>
                                    <td data-lang="en">Formats date to string</td>
                                    <td data-lang="vi">ƒê·ªãnh d·∫°ng ng√†y th√†nh chu·ªói</td>
                                    <td><code>date.strftime('%Y-%m-%d')</code></td>
                                </tr>
                                <tr>
                                    <td>timedelta</td>
                                    <td><code>total_seconds()</code></td>
                                    <td data-lang="en">Gets total time in seconds</td>
                                    <td data-lang="vi">L·∫•y t·ªïng th·ªùi gian theo gi√¢y</td>
                                    <td><code>delta.total_seconds()</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                
                    <div class="collapsible">
                        <div class="collapsible-header">
                            <div data-lang="en">üîÑ Type Conversion Examples</div>
                            <div data-lang="vi">üîÑ V√≠ D·ª• v·ªÅ Chuy·ªÉn ƒê·ªïi Ki·ªÉu</div>
                        </div>
                        <div class="collapsible-content">
                            <pre><span class="comment"># Safe string to int conversion</span>
<span class="keyword">def</span> <span class="function">safe_int_convert</span>(value, default=0):
    <span class="keyword">try</span>:
        <span class="keyword">return</span> int(value)
    <span class="keyword">except</span> ValueError:
        <span class="keyword">return</span> default

<span class="comment"># Examples of type conversion</span>
member_id = safe_int_convert(request.form.get(<span class="string">'member_id'</span>))
price = float(<span class="string">'10.99'</span>)
items = list((<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>))  <span class="comment"># tuple to list</span>
numbers = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">'123'</span>]  <span class="comment"># string to list of ints</span></pre>
                
                            <div data-lang="en">
                                <p>Always use safe conversion when handling user input:</p>
                                <ul>
                                    <li>Use <code>try/except</code> for conversions that might fail</li>
                                    <li>Provide default values for failed conversions</li>
                                    <li>Validate data before conversion when possible (<code>isdigit()</code>, etc.)</li>
                                </ul>
                            </div>
                            <div data-lang="vi">
                                <p>Lu√¥n s·ª≠ d·ª•ng chuy·ªÉn ƒë·ªïi an to√†n khi x·ª≠ l√Ω ƒë·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng:</p>
                                <ul>
                                    <li>S·ª≠ d·ª•ng <code>try/except</code> cho c√°c chuy·ªÉn ƒë·ªïi c√≥ th·ªÉ th·∫•t b·∫°i</li>
                                    <li>Cung c·∫•p gi√° tr·ªã m·∫∑c ƒë·ªãnh cho c√°c chuy·ªÉn ƒë·ªïi th·∫•t b·∫°i</li>
                                    <li>X√°c th·ª±c d·ªØ li·ªáu tr∆∞·ªõc khi chuy·ªÉn ƒë·ªïi khi c√≥ th·ªÉ (<code>isdigit()</code>, v.v.)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="database-state">
                    <div data-lang="en">
                        <h2>Understanding State and Database Operations</h2>
                        <p>The database maintains the "state" of our application - it remembers information between requests. This is crucial because HTTP is stateless (each request is independent).</p>
                    </div>
                    <div data-lang="vi">
                        <h2>Hi·ªÉu v·ªÅ Tr·∫°ng Th√°i v√† Thao T√°c Database</h2>
                        <p>Database duy tr√¨ "tr·∫°ng th√°i" c·ªßa ·ª©ng d·ª•ng - n√≥ ghi nh·ªõ th√¥ng tin gi·ªØa c√°c request. ƒêi·ªÅu n√†y quan tr·ªçng v√¨ HTTP l√† stateless (m·ªói request ƒë·ªôc l·∫≠p v·ªõi nhau).</p>
                    </div>

                    <pre><span class="comment"># Example of database state management</span>
<span class="keyword">def</span> <span class="function">return_book</span>(loan_id):
    <span class="keyword">try</span>:
        conn = get_db()
        cursor = conn.cursor()

        <span class="comment"># Query current state</span>
        loan = cursor.execute(<span class="string">'SELECT * FROM loans WHERE id = ?'</span>, 
                            (loan_id,)).fetchone()

        <span class="comment"># Update state</span>
        cursor.execute(<span class="string">'UPDATE books SET status = ? WHERE id = ?'</span>, 
                      (<span class="string">'available'</span>, loan[<span class="string">'book_id'</span>]))

        <span class="comment"># Commit changes to persist new state</span>
        conn.commit()

    <span class="keyword">finally</span>:
        <span class="comment"># Always close the connection</span>
        conn.close()</pre>

                    <div class="collapsible">
                        <div class="collapsible-header">
                            <div data-lang="en">üí° Understanding try-finally</div>
                            <div data-lang="vi">üí° Hi·ªÉu v·ªÅ try-finally</div>
                        </div>
                        <div class="collapsible-content">
                            <div data-lang="en">
                                <p>The try-finally block ensures that database connections are always closed, even if an error occurs. This is crucial for:</p>
                                <ul>
                                    <li>Preventing resource leaks</li>
                                    <li>Maintaining database connection limits</li>
                                    <li>Ensuring data consistency</li>
                                </ul>
                            </div>
                            <div data-lang="vi">
                                <p>Kh·ªëi try-finally ƒë·∫£m b·∫£o r·∫±ng c√°c k·∫øt n·ªëi database lu√¥n ƒë∆∞·ª£c ƒë√≥ng, ngay c·∫£ khi x·∫£y ra l·ªói. ƒêi·ªÅu n√†y quan tr·ªçng cho:</p>
                                <ul>
                                    <li>NgƒÉn ch·∫∑n r√≤ r·ªâ t√†i nguy√™n</li>
                                    <li>Duy tr√¨ gi·ªõi h·∫°n k·∫øt n·ªëi database</li>
                                    <li>ƒê·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa d·ªØ li·ªáu</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <section id="return-statements">
                <div data-lang="en">
                    <h3>Understanding Return Statements</h3>
                    <p>Return statements have two important characteristics in our route handlers:</p>
                </div>
                <div data-lang="vi">
                    <h3>Hi·ªÉu v·ªÅ C√¢u L·ªánh Return</h3>
                    <p>C√¢u l·ªánh return c√≥ hai ƒë·∫∑c ƒëi·ªÉm quan tr·ªçng trong c√°c route handler c·ªßa ch√∫ng ta:</p>
                </div>
            
                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">1Ô∏è‚É£ Early Returns</div>
                        <div data-lang="vi">1Ô∏è‚É£ Return S·ªõm</div>
                    </div>
                    <div class="collapsible-content">
                        <pre><span class="keyword">def</span> <span class="function">create_loan</span>():
    <span class="comment"># Validation checks first</span>
    <span class="keyword">if not</span> member_id:
        <span class="keyword">return</span> <span class="string">"Missing member ID"</span>, <span class="number">400</span>  <span class="comment"># Return early - no more code runs!</span>
        
    <span class="comment"># Database operations only happen if validation passes</span>
    book = cursor.execute(<span class="string">'SELECT status FROM books WHERE id = ?'</span>, 
                        (book_id,)).fetchone()
                        
    <span class="keyword">if not</span> book:
        <span class="keyword">return</span> <span class="string">"Book not found"</span>, <span class="number">404</span>  <span class="comment"># Another early return</span>
        
    <span class="comment"># This code only runs if all checks pass</span>
    cursor.execute(<span class="string">'INSERT INTO loans ...'</span>)</pre>
                        
                        <div data-lang="en">
                            <p>Early returns are a pattern where we check for invalid conditions first and return immediately if found. This:</p>
                            <ul>
                                <li>Prevents unnecessary database operations</li>
                                <li>Makes code easier to follow</li>
                                <li>Keeps our database operations safer</li>
                            </ul>
                        </div>
                        <div data-lang="vi">
                            <p>Return s·ªõm l√† m·ªôt m·∫´u trong ƒë√≥ ch√∫ng ta ki·ªÉm tra c√°c ƒëi·ªÅu ki·ªán kh√¥ng h·ª£p l·ªá tr∆∞·ªõc v√† return ngay l·∫≠p t·ª©c n·∫øu t√¨m th·∫•y. ƒêi·ªÅu n√†y:</p>
                            <ul>
                                <li>NgƒÉn ch·∫∑n c√°c thao t√°c database kh√¥ng c·∫ßn thi·∫øt</li>
                                <li>L√†m cho m√£ d·ªÖ theo d√µi h∆°n</li>
                                <li>Gi·ªØ cho c√°c thao t√°c database an to√†n h∆°n</li>
                            </ul>
                        </div>
                    </div>
                </div>
            
                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">2Ô∏è‚É£ Tuple Returns</div>
                        <div data-lang="vi">2Ô∏è‚É£ Return Tuple</div>
                    </div>
                    <div class="collapsible-content">
                        <pre><span class="comment"># These are all tuples!</span>
<span class="keyword">return</span> <span class="string">"Success"</span>, <span class="number">200</span>             <span class="comment"># (message, status_code)</span>
<span class="keyword">return</span> (<span class="string">"Not found"</span>, <span class="number">404</span>)         <span class="comment"># Same thing with parentheses</span>
<span class="keyword">return</span> messages[<span class="string">'error'</span>], <span class="number">500</span>    <span class="comment"># Variables work too!</span>

<span class="comment"># Just like any other tuple</span>
my_tuple = (<span class="string">"Success"</span>, <span class="number">200</span>)
<span class="keyword">return</span> my_tuple</pre>
            
                        <div data-lang="en">
                            <p>When we return two values separated by a comma in Flask routes, we're actually returning a tuple where:</p>
                            <ul>
                                <li>First element: Response message or data</li>
                                <li>Second element: HTTP status code</li>
                            </ul>
                            <p>The comma creates a tuple whether you use parentheses or not!</p>
                        </div>
                        <div data-lang="vi">
                            <p>Khi ch√∫ng ta return hai gi√° tr·ªã ƒë∆∞·ª£c ph√¢n t√°ch b·∫±ng d·∫•u ph·∫©y trong c√°c route Flask, ch√∫ng ta th·ª±c s·ª± ƒëang return m·ªôt tuple trong ƒë√≥:</p>
                            <ul>
                                <li>Ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n: Th√¥ng b√°o ph·∫£n h·ªìi ho·∫∑c d·ªØ li·ªáu</li>
                                <li>Ph·∫ßn t·ª≠ th·ª© hai: M√£ tr·∫°ng th√°i HTTP</li>
                            </ul>
                            <p>D·∫•u ph·∫©y t·∫°o ra m·ªôt tuple cho d√π b·∫°n c√≥ s·ª≠ d·ª•ng d·∫•u ngo·∫∑c ƒë∆°n hay kh√¥ng!</p>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <div class="container">
        <div class="inner-container">
            <section id="template-rendering">
                <div data-lang="en">
                    <h2>Template Rendering with Flask</h2>
                    <p>Understanding when and where code executes is crucial. Let's look at how Flask and Jinja2 work together:</p>
                </div>
                <div data-lang="vi">
                    <h2>Render Template v·ªõi Flask</h2>
                    <p>Hi·ªÉu khi n√†o v√† ·ªü ƒë√¢u m√£ ƒë∆∞·ª£c th·ª±c thi l√† r·∫•t quan tr·ªçng. H√£y xem c√°ch Flask v√† Jinja2 l√†m vi·ªác c√πng nhau:</p>
                </div>

                <pre><span class="comment"># In your HTML template</span>
&lt;form action=<span class="string">"{{ url_for('create_loan') }}"</span> method=<span class="string">"post"</span>&gt;

<span class="comment"># What actually gets sent to the browser</span>
&lt;form action=<span class="string">"/create_loan"</span> method=<span class="string">"post"</span>&gt;</pre>

                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">üîÑ Server vs Browser Execution</div>
                        <div data-lang="vi">üîÑ Th·ª±c Thi ·ªü Server v√† Browser</div>
                    </div>
                    <div class="collapsible-content">
                        <div data-lang="en">
                            <h4>Server-side (Flask/Python):</h4>
                            <ul>
                                <li>Template processing (Jinja2)</li>
                                <li>Database queries</li>
                                <li>Business logic</li>
                                <li>Authentication</li>
                            </ul>
                            <h4>Browser-side (JavaScript):</h4>
                            <ul>
                                <li>User interface interactions</li>
                                <li>Form validation</li>
                                <li>Dynamic content updates</li>
                                <li>API calls</li>
                            </ul>
                        </div>
                        <div data-lang="vi">
                            <h4>Ph√≠a Server (Flask/Python):</h4>
                            <ul>
                                <li>X·ª≠ l√Ω template (Jinja2)</li>
                                <li>Truy v·∫•n database</li>
                                <li>Logic nghi·ªáp v·ª•</li>
                                <li>X√°c th·ª±c</li>
                            </ul>
                            <h4>Ph√≠a Browser (JavaScript):</h4>
                            <ul>
                                <li>T∆∞∆°ng t√°c giao di·ªán ng∆∞·ªùi d√πng</li>
                                <li>Ki·ªÉm tra form</li>
                                <li>C·∫≠p nh·∫≠t n·ªôi dung ƒë·ªông</li>
                                <li>G·ªçi API</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="debugging">
                <div data-lang="en">
                    <h2>Debugging Flask Applications</h2>
                    <p>When things go wrong (and they will!), here's how to find and fix problems:</p>
                </div>
                <div data-lang="vi">
                    <h2>Debug ·ª®ng D·ª•ng Flask</h2>
                    <p>Khi c√≥ s·ª± c·ªë x·∫£y ra (v√† ch·∫Øc ch·∫Øn s·∫Ω c√≥!), ƒë√¢y l√† c√°ch t√¨m v√† s·ª≠a l·ªói:</p>
                </div>

                <pre><span class="comment"># Enable debug mode</span>
<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run(debug=<span class="keyword">True</span>)

<span class="comment"># Add print statements for debugging</span>
<span class="keyword">@app.route</span>(<span class="string">'/create_loan'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> <span class="function">create_loan</span>():
    <span class="function">print</span>(<span class="string">f"Form data: {request.form}"</span>)  <span class="comment"># Debug print</span>
    member_id = request.form.get(<span class="string">'member_id'</span>)</pre>

                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">üêõ Common Debugging Tips</div>
                        <div data-lang="vi">üêõ C√°c M·∫πo Debug Th∆∞·ªùng G·∫∑p</div>
                    </div>
                    <div class="collapsible-content">
                        <div data-lang="en">
                            <ul>
                                <li><strong>Check the Terminal:</strong> Flask prints errors and your print() statements here</li>
                                <li><strong>Browser Developer Tools:</strong> Check the Network tab for request/response details</li>
                                <li><strong>Database Verification:</strong> Use DB Browser for SQLite to check data directly</li>
                                <li><strong>Common Issues:</strong>
                                    <ul>
                                        <li>Forgetting to commit database changes</li>
                                        <li>Not closing database connections</li>
                                        <li>Incorrect route methods (GET vs POST)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div data-lang="vi">
                            <ul>
                                <li><strong>Ki·ªÉm Tra Terminal:</strong> Flask in ra l·ªói v√† c√°c c√¢u l·ªánh print() c·ªßa b·∫°n ·ªü ƒë√¢y</li>
                                <li><strong>C√¥ng C·ª• Developer Tools:</strong> Ki·ªÉm tra tab Network ƒë·ªÉ xem chi ti·∫øt request/response</li>
                                <li><strong>Ki·ªÉm Tra Database:</strong> S·ª≠ d·ª•ng DB Browser for SQLite ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu tr·ª±c ti·∫øp</li>
                                <li><strong>C√°c L·ªói Th∆∞·ªùng G·∫∑p:</strong>
                                    <ul>
                                        <li>Qu√™n commit thay ƒë·ªïi database</li>
                                        <li>Kh√¥ng ƒë√≥ng k·∫øt n·ªëi database</li>
                                        <li>Ph∆∞∆°ng th·ª©c route kh√¥ng ƒë√∫ng (GET vs POST)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="improvements">
                <div data-lang="en">
                    <h2>Current Limitations and Improvements</h2>
                    <p>Our current application has several limitations that would need to be addressed in a real-world scenario:</p>
                </div>
                <div data-lang="vi">
                    <h2>H·∫°n Ch·∫ø v√† C·∫£i Ti·∫øn</h2>
                    <p>·ª®ng d·ª•ng hi·ªán t·∫°i c·ªßa ch√∫ng ta c√≥ m·ªôt s·ªë h·∫°n ch·∫ø c·∫ßn ƒë∆∞·ª£c gi·∫£i quy·∫øt trong t√¨nh hu·ªëng th·ª±c t·∫ø:</p>
                </div>

                <div class="collapsible">
                    <div class="collapsible-header">
                        <div data-lang="en">‚ú® Suggested Improvements</div>
                        <div data-lang="vi">‚ú® ƒê·ªÅ Xu·∫•t C·∫£i Ti·∫øn</div>
                    </div>
                    <div class="collapsible-content">
                        <div data-lang="en">
                            <h4>1. Data Display</h4>
                            <p>Add routes to view:</p>
                            <ul>
                                <li>List of all books and their status</li>
                                <li>Member information and active loans</li>
                                <li>Loan history and due dates</li>
                            </ul>

                            <h4>2. User Experience</h4>
                            <ul>
                                <li>Add search functionality</li>
                                <li>Show confirmation messages</li>
                                <li>Add pagination for large lists</li>
                            </ul>

                            <h4>3. Error Handling</h4>
                            <ul>
                                <li>Better error messages</li>
                                <li>Input validation on the client side</li>
                                <li>Proper error pages</li>
                            </ul>
                        </div>
                        <div data-lang="vi">
                            <h4>1. Hi·ªÉn Th·ªã D·ªØ Li·ªáu</h4>
                            <p>Th√™m c√°c route ƒë·ªÉ xem:</p>
                            <ul>
                                <li>Danh s√°ch t·∫•t c·∫£ s√°ch v√† tr·∫°ng th√°i</li>
                                <li>Th√¥ng tin th√†nh vi√™n v√† c√°c kho·∫£n vay ƒëang ho·∫°t ƒë·ªông</li>
                                <li>L·ªãch s·ª≠ cho m∆∞·ª£n v√† ng√†y ƒë·∫øn h·∫°n</li>
                            </ul>

                            <h4>2. Tr·∫£i Nghi·ªám Ng∆∞·ªùi D√πng</h4>
                            <ul>
                                <li>Th√™m ch·ª©c nƒÉng t√¨m ki·∫øm</li>
                                <li>Hi·ªÉn th·ªã th√¥ng b√°o x√°c nh·∫≠n</li>
                                <li>Th√™m ph√¢n trang cho danh s√°ch l·ªõn</li>
                            </ul>

                            <h4>3. X·ª≠ L√Ω L·ªói</h4>
                            <ul>
                                <li>Th√¥ng b√°o l·ªói t·ªët h∆°n</li>
                                <li>Ki·ªÉm tra ƒë·∫ßu v√†o ·ªü ph√≠a client</li>
                                <li>Trang l·ªói ph√π h·ª£p</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-lang="en">
                    <h3>Example Route for Displaying Data</h3>
                    <p>Here's how we could implement a route to display all books:</p>
                </div>
                <div data-lang="vi">
                    <h3>V√≠ D·ª• Route Hi·ªÉn Th·ªã D·ªØ Li·ªáu</h3>
                    <p>ƒê√¢y l√† c√°ch ch√∫ng ta c√≥ th·ªÉ tri·ªÉn khai route ƒë·ªÉ hi·ªÉn th·ªã t·∫•t c·∫£ s√°ch:</p>
                </div>

                <pre><span class="keyword">@app.route</span>(<span class="string">'/books'</span>)
<span class="keyword">def</span> <span class="function">list_books</span>():
    <span class="keyword">try</span>:
        conn = get_db()
        cursor = conn.cursor()
        
        books = cursor.execute("""
            <span class="string">SELECT books.*, 
                   COALESCE(loans.due_date, 'Available') as status
            FROM books 
            LEFT JOIN loans 
                ON books.id = loans.book_id 
                AND loans.returned_date IS NULL</span>
        """).fetchall()
        
        <span class="keyword">return</span> render_template(<span class="string">'books.html'</span>, books=books)
        
    <span class="keyword">finally</span>:
        conn.close()</pre>
            </section>

            <section id="final-notes">
                <div data-lang="en">
                    <h2>Final Notes</h2>
                    <p>Remember that this project is focused on teaching route handling and database interactions. In a real application, you would need to consider:</p>
                    <ul>
                        <li>User authentication and authorization</li>
                        <li>Input sanitization and security</li>
                        <li>Error logging and monitoring</li>
                        <li>Backup and recovery procedures</li>
                        <li>Performance optimization</li>
                    </ul>
                </div>
                <div data-lang="vi">
                    <h2>Ghi Ch√∫ Cu·ªëi C√πng</h2>
                    <p>H√£y nh·ªõ r·∫±ng d·ª± √°n n√†y t·∫≠p trung v√†o vi·ªác d·∫°y x·ª≠ l√Ω route v√† t∆∞∆°ng t√°c database. Trong m·ªôt ·ª©ng d·ª•ng th·ª±c t·∫ø, b·∫°n c·∫ßn xem x√©t:</p>
                    <ul>
                        <li>X√°c th·ª±c v√† ph√¢n quy·ªÅn ng∆∞·ªùi d√πng</li>
                        <li>L√†m s·∫°ch ƒë·∫ßu v√†o v√† b·∫£o m·∫≠t</li>
                        <li>Ghi log l·ªói v√† gi√°m s√°t</li>
                        <li>Quy tr√¨nh sao l∆∞u v√† kh√¥i ph·ª•c</li>
                        <li>T·ªëi ∆∞u hi·ªáu su·∫•t</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Language toggle functionality
        document.querySelectorAll('input[name="language"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const selectedLang = e.target.value;
                // Hide all language elements first
                document.querySelectorAll('[data-lang]').forEach(el => {
                    if (el.dataset.lang === selectedLang) {
                        el.style.display = 'block';  // or 'table-cell' for td elements
                    } else {
                        el.style.display = 'none';
                    }
                });

                // Special handling for table cells
                document.querySelectorAll('td[data-lang], th[data-lang]').forEach(el => {
                    if (el.dataset.lang === selectedLang) {
                        el.style.display = 'table-cell';
                    } else {
                        el.style.display = 'none';
                    }
                });
            });
        });

        // Initialize English as default
        document.querySelectorAll('[data-lang]').forEach(el => {
            if (el.dataset.lang === 'en') {
                el.style.display = el.tagName.toLowerCase() === 'td' || el.tagName.toLowerCase() === 'th' 
                    ? 'table-cell' 
                    : 'block';
            } else {
                el.style.display = 'none';
            }
        });

        // Collapsible functionality
        document.querySelectorAll('.collapsible-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.parentElement;
                content.classList.toggle('open');
            });
        });
    </script>
</body>
</html>
